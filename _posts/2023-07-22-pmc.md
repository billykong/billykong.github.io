---
layout: post
title:  "PMC Metrics Meaning"
date:   2023-07-22 00:00:00 +1000
categories: linux performance
comments: true
published: false
---

### Background



### Events
Meaning, implicition, when/how to use, overhead, normal number?

#### cycles and ref-cycles
CPU cycles. More cycles usually means longer time.
But due to dynamic frequency scaling, CPU frequency changes from time to time.
So more cycles does not mean longer time.
ref-cycles is here for comparsion. It "offset" the changin frequency and provide a normalized metrics for comparsion.
ref-cycles(and cycles) is a measure of time rather than work done?
Where can we find documentation for the ref-cycles?
Since it is a hardware event(PMC), the linux kernel take it as it is from the hardware.
So documentation will likely comes from chip manufacturer like Intel or AMD.


Does it mean more work is done if it has more cycles?
How does it compare to instructions(retired)?

#### instructions
Instruction retired. The number of instructions a CPU has handled during the measurement period.
Different instructions takes different number of cycles to complete?

#### cache-references and cache-misses
Which cache are we talking about?
Since it is a PMC, it is CPU hardware event. So L1, L2, L$ caches?

#### branch and branch-misses
How many branch prediction have the CPU done?
Does branch prediction always happen when there is an `if` statement?
What number is normal?

#### task-clock

#### major-faults and minor-faults
Does major fault happens with swap only?
Does file reading causes major-fault?

#### cs
Context switch
It happens when
- we issue a syscall(most of the syscall; which syscalls does not causes context switch?)
- an interrupt happens to the CPU when it is running our application

Is there a way to differentiate voluntary context switch and involuntary context switch in perf?


#### migrations
The process is moved from one CPU to another. The overhead should be significant since we lost all the L1 to L3 caches.
Do we know if the process is even migrated to a CPU in the same NUMA group?




branch-instructions OR branches                    [Hardware event]
branch-misses                                      [Hardware event]
bus-cycles                                         [Hardware event]
cache-misses                                       [Hardware event]
cache-references                                   [Hardware event]
cpu-cycles OR cycles                               [Hardware event]
instructions                                       [Hardware event]
ref-cycles                                         [Hardware event]

alignment-faults                                   [Software event]
bpf-output                                         [Software event]
cgroup-switches                                    [Software event]
context-switches OR cs                             [Software event]
cpu-clock                                          [Software event]
cpu-migrations OR migrations                       [Software event]
dummy                                              [Software event]
emulation-faults                                   [Software event]
major-faults                                       [Software event]
minor-faults                                       [Software event]
page-faults OR faults                              [Software event]
task-clock                                         [Software event]

duration_time                                      [Tool event]
user_time                                          [Tool event]
system_time                                        [Tool event]

L1-dcache-load-misses                              [Hardware cache event]
L1-dcache-loads                                    [Hardware cache event]
L1-dcache-stores                                   [Hardware cache event]
L1-icache-load-misses                              [Hardware cache event]
LLC-load-misses                                    [Hardware cache event]
LLC-loads                                          [Hardware cache event]
LLC-store-misses                                   [Hardware cache event]
LLC-stores                                         [Hardware cache event]
branch-load-misses                                 [Hardware cache event]
branch-loads                                       [Hardware cache event]
dTLB-load-misses                                   [Hardware cache event]
dTLB-loads                                         [Hardware cache event]
dTLB-store-misses                                  [Hardware cache event]
dTLB-stores                                        [Hardware cache event]
iTLB-load-misses                                   [Hardware cache event]
node-load-misses                                   [Hardware cache event]
node-loads                                         [Hardware cache event]
node-store-misses                                  [Hardware cache event]
node-stores                                        [Hardware cache event]
mem-loads OR cpu/mem-loads/                        [Kernel PMU event]
mem-stores OR cpu/mem-stores/                      [Kernel PMU event]
ref-cycles OR cpu/ref-cycles/                      [Kernel PMU event]
slots OR cpu/slots/                                [Kernel PMU event]


